<DOCTYPE! html>
<html>
<head>
	<Title>å·²åˆ°è´§</Title>
	<script src="../js/jquery.js"></script>
</head>
<body>
<h1 style="text-align: center">ğŸ¤‘è¿™äº›å•å­æ˜¯ä½ å·²ç»ç¡®è®¤åˆ°è´§çš„ğŸ¤‘</h1>
<h4 style="text-align: center">ğŸ“¦ä½ ç°åœ¨å¯ä»¥å‘ç¥åŒ»å‘é€å‘è´§ç”³è¯·ï¼Œè¯·ä¸€å®šåŠæ—¶é€è´§ï¼Œå¥½æ‹¿åˆ°è¡€æ±—ğŸ’°ï¼ğŸ˜</h4>
<h4 style="text-align: center">ç¥åŒ»ç¡®è®¤åˆ°è´§åï¼Œå³å¯è¦æ±‚å¯¹æ­¤æ¬¡é€è´§çš„è¯·æ¬¾ã€‚</h4>
<div id="echoBackData" style="color: red"></div>
<div id="totalOrdersNum"></div>
<div id="confirmed-arrival-div"><img src="../images/orders_arrived.jpg" alt="http://www.sn.xinhuanet.com/2014-11/17/c_1113271812.htm" style="display: block; margin: 0 auto"></div>
<button id="send-sent-request-btn">å¯¹è¿™äº›è®¢å•è¦æ±‚å‘è´§</button>
</body>
<script>
	$(function(){
		var deliveryRequestCheckedArray = [];
		$.ajax({
				method: "post",
				url: "../nursePages/arrival_confirmed/arrival-confirmed-data-list.php",
				success: function(backData){
					if (backData != ''){
						$("#confirmed-arrival-div").html(backData);
					} else {
						
					}
					var totalOrders = $("div[class='arrived-orders-div']").length;
					//alert("1 " + totalOrders);
					$("#totalOrdersNum").html("æ€»å…±å•æ•°ï¼š" + totalOrders);
					//alert("2 " + totalOrders);
					//åº”è¯¥å°±æ˜¯0ï¼Œä¸æ˜¯undefinedï¼Œåˆšæ‰åœ¨ifé‡Œçš„undefinedçš„åŸå› åº”è¯¥æ˜¯äº‹å…ˆä»€ä¹ˆéƒ½æ²¡å®šä¹‰è€Œå·²
					if (totalOrders == 0){
						$('#send-sent-request-btn').remove();
					}
					$('#send-sent-request-btn').on("click", function() {
						//totalOrders åœ¨ä¸‹é¢ç”¨varé‡æ–°å®šä¹‰äº†ï¼Œæ˜¯ä¸æ˜¯è¿™ä¸ªåŸå› å¯¼è‡´è¿›æ¥çš„totalOrdersæˆä¸ºundefined?æŠŠä¸‹é¢çš„æ”¹ä¸ªåå­—ã€‚
						//alert("3 " + totalOrders);
						// https://www.youtube.com/watch?v=Fekw8FwJcOk
						// http://stackoverflow.com/questions/786142/how-to-retrieve-checkboxes-values-in-jquery Should be this one, or look at OBS around 040617 44204am
						/*if (totalOrders == undefined){ //ç«Ÿç„¶ä¸èƒ½æ˜¯0ï¼Œå¯èƒ½å› ä¸º$(div)ç›´æ¥æ²¡æœ‰äº†æ‰€ä»¥åœ¨jsé‡Œè¢«å®šä¹‰ä¸ºundefinedè€Œé0
							alert("å“ªé‡Œè¿˜æœ‰è®¢å•ï¼ŸğŸ˜‚æ´—æ´—ç¡å§ï¼ğŸ¤£");
						} else {
							
						}*/
						$("input[class=check-for-delivery-request]").each(function(){
							if ($(this).is(':checked')){
								//deliveryRequestCheckedArray.push($(this).attr("data-delivery-request-for-orderTakenId")); âŒï¼Œè¿™é‡Œæˆ‘å†™çš„æ˜¯orderTakenIdä½†PHPå®é™…ä¸Šä¼ æ¥äº†orderIdï¼Œè¦æ”¹ä¸ºçœŸçš„orderTakenIdï¼Œå°±æ˜¯åˆšæ‰åŠ çš„data-confirm-order-div-orderTakenId='$orderTakenId'ã€‚æœ¬æ¥é€»è¾‘ä¸Šä¹Ÿå¯¹ï¼Œå°±è¯¥ç›´æ¥åŠ orderTakenIdï¼Œå†è¯´ä¹Ÿæ¯”ç”¨orderIdå†å›å»join tableä»€ä¹ˆçš„ä¹Ÿæ–¹ä¾¿ï¼Œå› ä¸ºæœ¬æ¥å¼„å¾—IDéƒ½æ˜¯primary keyï¼ˆwell, in orders it's unique key)ï¼Œæ‰€ä»¥ä¸€ä¸ªäººä¸‹ä¸€ä¸ªå•ä¹Ÿå¯¹åº”ä¸€ä¸ªunique orderTakenIdï¼Œå—¯ä¹Ÿä¾¿äºæˆ‘ç¨ågroup by userç­‰ç­‰
								deliveryRequestCheckedArray.push($(this).parent().attr("data-confirm-order-div-orderTakenId"));
							}
						});

						//alert(deliveryRequestCheckedArray);
						if(confirm("ç¡®è®¤å¯¹è¿™äº›å•å­é€è´§ï¼Ÿ\nè¯·ä»”ç»†æ ¸å¯¹ï¼Œç›®å‰ä¸æ”¯æŒåæ‚”ã€‚")){
							var sentData = "deliveryRequestCheckedArray=" + deliveryRequestCheckedArray;
							$.ajax({
								method: "post",
								url: "../nursePages/arrival_confirmed/sent-delivery-request.php?",
								data: sentData,
								success: function(backData){
									$("#echoBackData").html(backData);
									//$("#page-switch").load("../nursePages/arrival-confirmed.html"); Actually refreshing the page, WITH by looking at the table content as well helps me find the problem. The .each function does work great since from the databse the array shows correct, but every time the array will be added again with one item eliminated, so the problem must be in PHP the query didn't label each order status to confirmed correctly, but only the first one in the array! Let's find out!
								}
							});
							/*$("input[class=check-for-delivery-request]").each(function(){
								$(this).remove();
							});*/
							$("input[class=check-for-delivery-request]").each(function(){
								if ($(this).is(':checked')){
									// https://www.google.com/webhp?sourceid=chrome-instant&rlz=1C5CHFA_enUS728US728&ion=1&espv=2&ie=UTF-8#q=jquery+get+parent+div
									$(this).parent().remove();
									//var totalOrders = $("div[class='ongoingOrdersTableList']").length; ä¸éœ€è¦ï¼Œäººå®¶parent removeçš„å¥½å¥½çš„ã€‚
								}
							});
							//æ”¹åï¼Œé˜²æ­¢ä¸Šé¢undefined
							//é—®é¢˜åˆæ¥äº†ï¼Œé‡æ–°åŠ è½½åtotalOrderä¸ä¼šå˜æˆ0.ã€‚ã€‚ç®—äº†ç›´æ¥éšè—buttonï¼
							//var totalOrdersNew = $("div[class='arrived-orders-div']").length;
							//var totalOrders = $("div[class='arrived-orders-div']").length;
							//çªç„¶æ„Ÿè§‰ä¸ç”¨é‡æ–°å®šä¹‰varï¼Œè¿™æ ·å°±ä¸€è‡´äº†å§ï¼Œç„¶åæŠŠif == 0ä¹Ÿç§»åŠ¨ä¸‹æ¥
							totalOrders = $("div[class='arrived-orders-div']").length;
							$("#totalOrdersNum").html("æ€»å…±å•æ•°ï¼š" + totalOrders);
							if (totalOrders == 0){
								$('#send-sent-request-btn').remove();
							}

						}
						
					});
					/*
					var elementsToCheck = document.getElementsByClassName('check-for-delivery-request');
					for(var i = 0; i < elementsToCheck.length; i++) {
					    if(elementsToCheck[i].checked) {
							deliveryRequestCheckedArray.push("haha");
						}
					}
					$("#send-sent-request-btn").on("click", function(){
							alert(deliveryRequestCheckedArray);
					});
					*/	
				}
		});
	});
</script>
</html>