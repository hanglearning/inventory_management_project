<DOCTYPE! html>
<html>
<head>
	<Title>已到货</Title>
	<script src="../js/jquery.js"></script>
</head>
<body>
<h1 style="text-align: center">🤑这些单子是你已经确认到货的🤑</h1>
<h4 style="text-align: center">📦你现在可以向神医发送发货申请，请一定及时送货，好拿到血汗💰！😍</h4>
<h4 style="text-align: center">神医确认到货后，即可要求对此次送货的请款。</h4>
<div id="totalOrdersNum"></div>
<div id="confirmed-arrival-div"></div>
<button id="send-sent-request-btn">对这些订单要求发货</button>
</body>
<script>
	$(function(){
		var deliveryRequestCheckedArray = [];
		$.ajax({
				method: "post",
				url: "../nursePages/arrival_confirmed/arrival-confirmed-data-list.php",
				success: function(backData){
					$("#confirmed-arrival-div").html(backData);
					var totalOrders = $("div[class='arrived-orders-div']").length;
					$("#totalOrdersNum").html("总共单数：" + totalOrders);
					$('#send-sent-request-btn').on("click", function() {
						// https://www.youtube.com/watch?v=Fekw8FwJcOk
						// http://stackoverflow.com/questions/786142/how-to-retrieve-checkboxes-values-in-jquery Should be this one, or look at OBS around 040617 44204am
						$("input[class=check-for-delivery-request]").each(function(){
							if ($(this).is(':checked')){
								deliveryRequestCheckedArray.push($(this).attr("data-delivery-request-for-orderTakenId"));
							}
						});
						//alert(deliveryRequestCheckedArray);
						if(confirm("确认对这些单子送货？\n请仔细核对，目前不支持反悔。")){
							var sentData = "deliveryRequestCheckedArray=" + deliveryRequestCheckedArray;
							$.ajax({
								method: "post",
								url: "../nursePages/arrival_confirmed/sent-delivery-request.php?",
								data: sentData,
								success: function(backData){
									alert(backData);
									$("#page-switch").load("../nursePages/arrival-confirmed.html");
								}
							});
							/*$("input[class=check-for-delivery-request]").each(function(){
								$(this).remove();
							});*/
							$("input[class=check-for-delivery-request]").each(function(){
								if ($(this).is(':checked')){
									// https://www.google.com/webhp?sourceid=chrome-instant&rlz=1C5CHFA_enUS728US728&ion=1&espv=2&ie=UTF-8#q=jquery+get+parent+div
									$(this).parent().remove();
								}
							});
						}
					});
					/*
					var elementsToCheck = document.getElementsByClassName('check-for-delivery-request');
					for(var i = 0; i < elementsToCheck.length; i++) {
					    if(elementsToCheck[i].checked) {
							deliveryRequestCheckedArray.push("haha");
						}
					}
					$("#send-sent-request-btn").on("click", function(){
							alert(deliveryRequestCheckedArray);
					});
					*/	
				}
		});
	});
</script>
</html>