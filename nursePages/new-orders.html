<DOCTYPE! html>
<html>
<head>
	<title>æ–°çš„è®¢å•</title>
	<script src="../js/jquery.js" type="text/javascript"></script>
	<script src="../js/moment.js"></script>	
</head>
<body>

	<h1>è¿™é‡Œæœ‰æ–°çš„ğŸšå¯ä»¥åƒ</h1>
	<h4 style="text-align: center">æ³¨æ„ï¼Œå¦‚æœåŠ è½½è¾ƒæ…¢ï¼Œæ˜¯å› ä¸ºæœ‰äººæ­£åœ¨é¢†å•ï¼Œå› ä¸ºæˆ‘ä»¬è¦æ›´æ–°ä»–é¢†å®Œå•åè¿˜å‰©ä½™å¤šå°‘æ•°é‡ï¼Œè¯·è€å¿ƒç­‰å¾…ï¼Œä¸å¿…åˆ·æ–°ã€‚</h4>
	<div id="echoBackData"></div>
	<div id="totalOrdersNum"></div>
	<div id="ordersTable"></div>

</body>
<script type="text/javascript">
	
	$(document).ready(function(){
		//https://jsfiddle.net/chenhang91/Lsemz2xp/
		// So number can be implicitly converted to string if was added to string
		function submitQty(_qty, _takeOrderId, _userId, _qtyLeftNeeded){
			if (confirm("è¯·ç¡®è®¤æ•°é‡: " + _qty)){
				var sendData = "orderId=" + _takeOrderId + "&userId=" + _userId + "&qtyTaken=" + _qty +
				"&orderStatus=1" + "&qtyLeftNeeded=" + _qtyLeftNeeded;
				$.ajax({
					method: "post",
					url: "../nursePages/new_orders/orderTaken.php?",
					data: sendData,
					success: function(backData){
						$("div[data-take-order-div-orderId=" + _takeOrderId + "]").remove();
						var totalOrders = $("div[class='ongoingOrdersTableList']").length;
						$("#totalOrdersNum").html("æ€»å…±å•æ•°ï¼š" + totalOrders + "ã€‚");
						$("#echoBackData").html(backData);
						//$("#page-switch").load("../nursePages/new-orders.html");
						//åˆ·æ–°å°±æ˜¾ç¤ºä¸å‡º("#echoBackData")ï¼Œä¸åˆ·æ–°å°±åªèƒ½removeä½†è®¢å•æ•°é‡å°±é”™äº†ï¼Œå¥½çº ç»“ï¼Œå¾—ç ”ç©¶è§£å†³åŠæ³•ã€‚
						//å“ï¼é‡æ–°è®¡ç®—ä¸å°±è¡Œäº†ï¼Ÿçœ‹ç¬¬32ï¼Œ33è¡Œã€‚
						// 041017 61044am 3E å¥½äº†ï¼å“ˆå“ˆï¼
						/*$(function(){
							$("#echoBackData").html(backData);
							$("#echoBackData").css("display", "block");
						});*/
					}
				});
			} else {
				// Back to the order submit page
			}
		}
		$.ajax({
			method: "post",
			url: "../nursePages/new_orders/new-orders.php",
			success: function(backData){
				$("#ordersTable").html(backData);
				var totalOrders = $("div[class='ongoingOrdersTableList']").length;
				$("#totalOrdersNum").html("æ€»å…±å•æ•°ï¼š" + totalOrders);
				$(".take-order-btn").on("click", function(){
					var userId = $(this).attr("data-submit-order-userId");
					var takeOrderId = $(this).attr("data-take-orderId");
					// Change takeOrderId to orderId in this page later if remembered
					var qtyLeftNeeded = $(this).attr("data-qtyLeftNeeded");
					//http://stackoverflow.com/questions/1944302/jquery-select-an-elements-class-and-id-at-the-same-time
					//Select both class and id at the same time (Eventually didn't use, see OBS 040317 92121pm 3E)
					// Used this select style, remembered from new-order.html line90
					if (qtyLeftNeeded != "ALL IN"){

						var takeOrderDivHtml = "æˆ‘è¦ä¸‹è¿™ä¹ˆå¤š: <input type=text data-qtyInput-orderId='" + takeOrderId + "' required>" +
											" ä¸èƒ½è¶…è¿‡" + qtyLeftNeeded + "å“¦ï¼<br/>" +
											"<button class='qty-submit-btn' data-qtySubmit-orderId='" + takeOrderId + "' type='submit'>ä¸‹å•ï¼</button>";
						$("div[data-take-orderId-div=" + takeOrderId + "]").html(takeOrderDivHtml);
					} else {
						var takeOrderDivHtml = "æ•°é‡ï¼ˆæ³¨æ„ç»†æ°´é•¿æµï¼Œåˆ«è¢«é»‘åœ°å€ï¼ï¼‰ <input type=text data-qtyInput-orderId='" + takeOrderId + "' required>" + ".<br/>" +
											"<button class='qty-submit-btn' data-qtySubmit-orderId='" + takeOrderId + "' type='submit'>ä¸‹å•ï¼</button>";
						$("div[data-take-orderId-div=" + takeOrderId + "]").html(takeOrderDivHtml);
					}
					$("button[data-qtySubmit-orderId=" + takeOrderId + "]").on("click", function(){
						//å³ä¾¿parseIntåä¼ åˆ°phpä¹Ÿåº”è¯¥å˜æˆstringäº†ã€‚å“¦ï¼POSTå¯¹äºJSä¸PHPç®—ä¸ç®—æ˜¯ä¸€ä¸ªAPIï¼Ÿå“¦ï¼æ€ªä¸å¾—å«RESTful APIï¼Ÿï¼ï¼ï¼å› ä¸ºæœ‰POSTï¼Ÿï¼Ÿï¼
						var qtySubmit = parseInt($("input[data-qtyInput-orderId=" + takeOrderId + "]").val());
						if (qtySubmit == 0) {
							alert("å°±ä¸‹0ä¸ªğŸ¥šï¼Œä½•ä¸ç›´æ¥åˆ é™¤è®¢å•ï¼Ÿä½ è€æˆ‘ï¼ŸğŸ˜’");
						} else if (qtySubmit < 0) {
							alert("ğŸ˜ˆåˆ«ä»¥ä¸ºç¼–ç½‘ç«™çš„äººæ˜¯ä¸ªé€—é€¼å°±å…è®¸ä½ è¿™ä¹ˆèƒ¡æ¥ï¼");
						} else {
							if (qtyLeftNeeded != "ALL IN"){
								if (qtySubmit == parseInt(qtyLeftNeeded)){
									alert("WOW!ğŸ˜®ä½ è¦åŒ…åœ†å„¿å•Šï¼");
									submitQty(qtySubmit, takeOrderId, userId, qtyLeftNeeded);
								} else if (qtySubmit > parseInt(qtyLeftNeeded)){
									alert("ğŸ˜±ä½ èƒƒå£å¤ªå¤§ï¼Œæˆ‘ä¼¤ä¸èµ·ï¼");
								} else {
									submitQty(qtySubmit, takeOrderId, userId, qtyLeftNeeded);
								}
							} else { //All In
								submitQty(qtySubmit, takeOrderId, userId, qtyLeftNeeded);
							}
						}
						
						/*
						if (confirm("è¯·ç¡®è®¤æ•°é‡: " + qtySubmit)){
							var sendData = "orderId=" + takeOrderId + "&userId=" + userId + "&qtyTaken=" + qtySubmit +
							"&orderStatus=1";
							$.ajax({
								method: "post",
								url: "../nursePages/new_orders/orderTaken.php?",
								data: sendData,
								success: function(backData){
									alert(backData);
									$("div[data-take-order-div-orderId=" + takeOrderId + "]").remove();
								}
							});
						} else {
							// Back to the order submit page
						}
						*/
					});
				});

				$(".delete-order-btn").on("click", function(){
					var userId = $(this).attr("data-delete-order-userId");
					var deleteOrderId = $(this).attr("data-delete-orderId");
					var profitPerItem = $(this).attr("data-give-up-profit")
					if(confirm("ä½ ç¡®å®šè¦æ”¾å¼ƒèµš$" + profitPerItem + "çš„æœºä¼š?\n (è¯·æ³¨æ„ç›®å‰çš„ç³»ç»Ÿä¸­ä½ æ— æ³•é‡æ–°é¢†ä»»åŠ¡ï¼Œæ”¾å¼ƒå°±æ˜¯æ”¾å¼ƒäº†ï¼Œä»¥åå‡çº§ä¸­å…è®¸ä½ é‡æ–°ç”³é¢†ä»»åŠ¡ã€‚)")){
						//$("div[data-take-order-div-orderId=" + deleteOrderId + "]").remove();
						var sendData = "orderId=" + deleteOrderId + "&userId=" + userId + "&qtyTaken=0" +
							"&orderStatus=0";
							$.ajax({
								method: "post",
								url: "../nursePages/new_orders/orderDeleted.php?",
								data: sendData,
								success: function(backData){
									//alert(backData); When testing feel so annoying since it's not necessary to confirm the message but just seeing it. So let's just show it.
									/*
									$("#page-switch").load("../nursePages/new-orders.html");
									$("#echoBackData").html(backData);
									$("#echoBackData").css("display", "block");
									041017 61152am 3E ç´§æ¥ç€æ”¹å®Œä¸Šä¸€ä¸ªbtnæµ‹è¯•å‘ç°è¿™ä¸€ä¸ªä¹Ÿå¾—æ”¹*/
									$("div[data-take-order-div-orderId=" + deleteOrderId + "]").remove();
									var totalOrders = $("div[class='ongoingOrdersTableList']").length;
									$("#totalOrdersNum").html("æ€»å…±å•æ•°ï¼š" + totalOrders + "ã€‚");
									$("#echoBackData").html(backData);
								}
							});
					} else {
						// Do nothing
					}
				});
			}
		});
	});
	/*
	$( document).ajaxComplete(function() {
  			$("#take-order-btn").on("click", function(){
				alert("take this order");
		});
  	});	
  	*/
</script>
</html>