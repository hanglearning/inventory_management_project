<!DOCTYPE html>
<html>
<head>
	<Title>æ–°å»ºè®¢å•</Title>
	<script src="../js/jquery.js"></script>
	<script src="../js/moment.js"></script>
	<style>
	#itemReceivingPrice {
		font-size: 40px;
	}
	</style>
</head>
<body>
	<div style="width: 600px; margin: auto">
		<h1>ğŸ“æ–°å»ºä¸€ä¸ªè®¢å•</h1>
		<br/>
		<form id="order-creation-form" novalidate>
				<strong>è´§ç‰©åç§°</strong>
				<input id="itemName" type="text" required />
				<br/>
				<span>æ¯”å¦‚è¯´Dell 24 Monitorã€‚</span>
			<br/>
				<strong>é“¾æ¥</strong>
				<input id="itemLink" type="text" placeholder="http://" required />
				<br/>
				<span>ä¹°è¿™ä¸ªä¸œè¥¿çš„ç½‘é¡µåœ°å€ã€‚â€¼ï¸è¯·æ³¨æ„ä¸€å®šä»¥http://æˆ–https://å¼€å¤´ï¼Œå¦åˆ™å°æŠ¤å£«æ— æ³•ç›´æ¥ç‚¹å‡»ï¼</span>
			<br/>
			<br/>
				<strong>æ”¶è´§æ•°é‡ç±»å‹</strong>
				<span><input id="limited-quantity-radio-btn" name="qtyType" type="radio" checked="checked" />é™åˆ¶</span>
				<span><input id="all-in-radio-btn" name="qtyType" type="radio" />All In</span>
			<br/>
				<div id="totalQtyDiv">
					<strong>æ€»æ”¶è´§æ•°é‡</strong>
					<input id="totalQty" type="text" required />
					<br/>
					<span>å¦‚æœä¸æ˜¯All Inï¼Œéœ€è¦å¡«æ­¤é¡¹ï¼Œå•ä½ä¸ºå•ä¸ªè´§å“æ•°é‡è€Œéè®¢å•æ•°é‡ã€‚</span>
				</div>
				<strong>æˆæœ¬</strong>
				<input id="itemCost" type="text" required />
				<br/>
				<span>æœ¬è´§ç‰©çš„æ ‡ä»·ã€‚</span>
			<br/>
				<strong>è¿è´¹</strong>
				<input id="itemShipping" type="text" value="0" required />
				<br/>
				<span>ä¸€ä¸ªè®¢å•çš„è¿è´¹ã€‚æ³¨æ„ï¼Œä»¥åçš„ç³»ç»Ÿå‡çº§ä¼šåŠ å…¥ä¸€ä¸ªè®¢å•å¤šä¸ªè´§ç‰©ä¸€ä¸ªshippingçš„è¾“å…¥ã€‚</span>
				<span>å¦‚æœç›®å‰éœ€è¦è¿™ç§è®¢å•ï¼Œè¯·åœ¨æ³¨æ„é‡Œé¢æ ‡æ³¨ã€‚</span>
			<br/>
				<strong>åˆ©æ¶¦</strong>
				<input id="profitPerItem" type="text" required />
				<br/>
				<span>ä¸€ä¸ªè´§ç‰©åŠ å¤šå°‘é’±ï¼Ÿ</span>
			<br/>
				<br/>
				<strong>æ”¶è´§ä»·æ ¼ï¼š</strong>
				<span id="itemReceivingPrice"></span>
				<br/>
				<span>è‡ªåŠ¨è®¡ç®—ã€‚</span>
			<br />
				<strong>Cashbackå»ºè®®</strong>
				<input id="cashBackRec" type="text" required=""/>
				<br/>
				<span>ä¸‹ä¸€æ¬¡ç³»ç»Ÿå‡çº§å¯ä»¥ç›´æ¥æå–æœ€é«˜çš„cashbackçš„ç½‘ç«™ã€‚</span>
			<br />
				<strong>è®¢å•æœ‰æ•ˆæ—¶é—´</strong>
				<select id="validFor">
				  <option value="2">2å°æ—¶</option>
				  <option value="4">4å°æ—¶</option>
				  <option value="12">12å°æ—¶</option>
				  <option value="24">1å¤©</option>
				  <option value="x" selected="selected">ç›´åˆ°æ‰‹åŠ¨æˆªå•</option>
				  <option value="custom">è‡ªå®šä¹‰</option>
				</select>
				<div id="custom-validFor-div" style="display: none;">
					<input id="custom-validFor-day" type="text" value="0">å¤©
					<input id="custom-validFor-hour" type="text" value="0">å°æ—¶
				</div>
				<br/>
				<span>ç›®å‰è¿˜æ˜¯å¾—æ‰‹åŠ¨å…³é—­è®¢å•ï¼Œä¸‹æ¬¡ç³»ç»Ÿå‡çº§å½“è®¢å•è¿‡æœŸä¼šè¢«è‡ªåŠ¨å…³é—­ã€‚</span>
			<br />
				<strong>å¤‡æ³¨</strong>
				<br/>
				<textarea rows="4" cols="50" id="orderNote" form="order-creation-form"></textarea>
				<br/>
				<span>ä¸€å•æœ€å¤šä¸‹å‡ ä¸ªï¼Ÿè¿è´¹ç‰¹æ®Šè¦æ±‚ï¼Ÿå…¶ä»–æ³¨æ„äº‹é¡¹ï¼Ÿ</span>
			<br />
				<button id="order-sumbmit-btn" type="submit">æäº¤</button>
				<div id="backData"></div>
		</form>
	</div>
	<script>

		$(document).ready(function(){
			
			// Process qtyType (Listen to the radio button)
			// Select by attribute and its value in jQuery
			$("input[name='qtyType']").change(function(){
				if($('#all-in-radio-btn').is(':checked')) { $("#totalQtyDiv").hide(); }
				else {$("#totalQtyDiv").show();}
			});

			// Auto calculate total receiving price
			$("#itemCost, #itemShipping, #profitPerItem").keyup(function(){
				$("#itemReceivingPrice").text('$' + ((parseFloat($("#itemCost").val()) + parseFloat($("#itemShipping").val()) + parseFloat($("#profitPerItem").val())) || 0 ).toString());
			});

			// Process custom valid for (Listen to the dropdown)
			$("#validFor").on('change', function() {
			    if ($(this).val() == 'custom'){
			        $("#custom-validFor-div").css("display", "block");
			    } else {
			    	$("#custom-validFor-div").css("display", "none");
			    }
			});

			$("#order-creation-form").on("submit", function(e){

				e.preventDefault();

				var itemReceivingPrice = parseFloat($("#itemCost").val()) + parseFloat($("#itemShipping").val()) + parseFloat($("#profitPerItem").val());

				var totalQty;
				if($('#all-in-radio-btn').is(':checked')){
					totalQty = "ALL IN";
				} else {
					totalQty = $("#totalQty").val();
				}
				/*var qtyTypeButtonId = $("input[name='qtyType']").attr("id");
				alert ('qtyTypeButtonId ' + qtyTypeButtonId);
				if(qtyTypeButtonId == "limited-quantity-radio-btn"){
					totalQty = $("#totalQty").val();
				} else {
					totalQty = "ALL IN";
					alert('totalQty ' + totalQty);
				}*/

				var validBy;
				var validFor = $("#validFor option:selected").val();
				switch(validFor){
					case '2':
						validBy = moment().add(2, 'hours');
						break;
					case '4':
						validBy = moment().add(4, 'hours');
						break;
					case '12':
						validBy = moment().add(12, 'hours');
						break;
					case '24':
						validBy = moment().add(24, 'hours');
						break;
					case 'x':
						validBy = moment().add(87360, 'hours');
						break;
					case 'custom':
						var customDay = parseInt($("#custom-validFor-day").val());
						var customHour = parseInt($("#custom-validFor-hour").val());
						var totalCustomHour = customDay * 24 + customHour;
						validBy = moment().add(totalCustomHour, 'hours');
						break;
				}				

				var itemName 		= $("#itemName").val();
				var itemLink 		= $("#itemLink").val();
				var itemCost 		= $("#itemCost").val();
				var itemShipping 	= $("#itemShipping").val();
				var profitPerItem 	= $("#profitPerItem").val();
				var cashBackRec		= $("#cashBackRec").val();
				var orderNote 		= $("#orderNote").val();
				var creationTime	= moment().format('YYYY-MM-DD hh:mm:ss');


				var confirmText = "è¯·ç¡®è®¤:\nè®¢å•åç§°: " + itemName + ",\né“¾æ¥: " +
								  itemLink +",\næ€»æ•°é‡: " + totalQty + ",\næˆæœ¬: " + itemCost + ",\nè¿è´¹: "+ itemShipping + ",\nå•ä¸ªè´§ç‰©æ‰€åŠ åˆ©æ¶¦: " + profitPerItem + ",\næ”¶è´§ä»·æ ¼: " + itemReceivingPrice + ",\ncash back å»ºè®®: " + cashBackRec + 
								  	  ",\næœ‰æ•ˆæœŸè‡³: " + validBy.format('YYYY-MM-DD hh:mm:ss') + ".";

				//var itemLinkHTMLProcessed = makeLink(itemLink);

				if (confirm(confirmText)) {
				    var orderData = "itemName=" + itemName + 
								"&itemLink=" + itemLink +
								"&totalQty=" + totalQty + 
								"&itemCost=" + itemCost + 
								"&itemShipping=" + itemShipping + 
								"&profitPerItem=" + profitPerItem + 
								"&itemReceivingPrice=" + itemReceivingPrice + 
								"&cashBackRec=" + cashBackRec +
								"&validBy=" + validBy.format('YYYY-MM-DD hh:mm:ss') +
								"&orderNote=" + orderNote +
								"&creationTime=" + creationTime;

					$.ajax({
						method: "post",
						url: 	"../adminPages/new_order/new-order.php?",
						data: 	orderData,
						success: function(backData){
							$("#backData").html(backData);
						}
					});
				} else {
				}
				
			});
		});
	</script>
</body>
</html>